---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\cl3852\Documents\GitHub\PanelEconometrics\Assignments\HW5\HW5.log
  log type:  text
 opened on:   8 May 2019, 14:56:18

. use "$root\Cigar.dta", clear

. 
. ********************************************************************************
. sort state yr 

. xtset state yr
       panel variable:  state (strongly balanced)
        time variable:  yr, 63 to 92
                delta:  1 unit

. 
. *Question 1
. *Variables in the regressions are in real term: adjusted for inflation using CPI
. 
. g c=sales*100/cpi

. sort state yr 

. by state: gen clag = c[_n-1]
(46 missing values generated)

. g lnc=ln(c)

. g lnclag=ln(clag)
(46 missing values generated)

. g y=ndi*100/cpi

. g lny=ln(y)

. g p=price*100/cpi

. g lnp=ln(p)

. g pn=pimin*100/cpi

. g lnpn=ln(pn)

. 
. eststo clear

. eststo sumstats: estpost summarize price pop pop16 cpi ndi sales pimin ///
>         lnc lnclag lnp lny lnpn

             |  e(count)   e(sum_w)    e(mean)     e(Var)      e(sd)     e(min)     e(max)     e(sum) 
-------------+----------------------------------------------------------------------------------------
       price |      1380       1380   68.69993   1762.846   41.98626       23.4      201.9    94805.9 
         pop |      1380       1380   4537.113   2.33e+07   4828.836        319    30703.3    6261216 
       pop16 |      1380       1380   3366.616   1.33e+07   3641.847      215.2      22920    4645930 
         cpi |      1380       1380   73.59667   1334.392   36.52933       30.6      140.3   101563.4 
         ndi |      1380       1380   7525.023   2.25e+07   4747.859   1322.573      23074   1.04e+07 
       sales |      1380       1380   123.9509    960.445   30.99105       53.4      297.9   171052.2 
       pimin |      1380       1380   62.89928   1468.662   38.32313       23.4      178.5      86801 
         lnc |      1380       1380    5.23227   .3665364   .6054225    3.66872   6.817033   7220.533 
      lnclag |      1334       1334   5.266399   .3427621   .5854589   3.670727   6.817033   7025.376 
         lnp |      1380       1380   4.498752   .0230363   .1517772   3.995361    4.96916   6208.277 
         lny |      1380       1380   9.150421    .044078   .2099475   8.371505    9.72215   12627.58 
        lnpn |      1380       1380   4.410703   .0228418   .1511349   3.995361   4.845976    6086.77 

. esttab sumstats using $root\Table1.rtf, replace main(mean %6.2f) aux(sd) ///
>         cell("mean sd") nomtitles title(Table 1: Summary Statistics) ///
>         addnotes("Created variables: lnc lnclag lnp lny lnpn")
(output written to C:\Users\cl3852\Documents\GitHub\PanelEconometrics\Assignments\HW5\Table1.rtf)

. 
. ssc install sutex
checking sutex consistency and verifying not already installed...
all files already exist and are up to date.

. *help sutex
. sutex price pop pop16 cpi ndi sales pimin lnc lnclag lnp lny lnpn, minmax ///
>         file("$root\Table1.tex") replace
file C:\Users\cl3852\Documents\GitHub\PanelEconometrics\Assignments\HW5\Table1.tex saved

. 
. 
. *Question 2
. *(1) OLS 
. eststo clear

. eststo OLS: reg lnc lnclag lnp lny lnpn

      Source |       SS           df       MS      Number of obs   =     1,334
-------------+----------------------------------   F(4, 1329)      =  57624.33
       Model |  472.054101         4  118.013525   Prob > F        =    0.0000
    Residual |  2.72176674     1,329  .002047981   R-squared       =    0.9943
-------------+----------------------------------   Adj R-squared   =    0.9943
       Total |  474.775868     1,333  .356170944   Root MSE        =    .04525

------------------------------------------------------------------------------
         lnc |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   1.013358   .0025238   401.52   0.000     1.008407     1.01831
         lnp |   .0041021   .0144202     0.28   0.776    -.0241868     .032391
         lny |  -.0615589   .0070966    -8.67   0.000    -.0754807    -.047637
        lnpn |    .079092   .0141066     5.61   0.000     .0514185    .1067655
       _cons |    .065667   .0812072     0.81   0.419    -.0936412    .2249752
------------------------------------------------------------------------------

. 
. *(2) Within
. tab yr, g(yrd)

         yr |      Freq.     Percent        Cum.
------------+-----------------------------------
         63 |         46        3.33        3.33
         64 |         46        3.33        6.67
         65 |         46        3.33       10.00
         66 |         46        3.33       13.33
         67 |         46        3.33       16.67
         68 |         46        3.33       20.00
         69 |         46        3.33       23.33
         70 |         46        3.33       26.67
         71 |         46        3.33       30.00
         72 |         46        3.33       33.33
         73 |         46        3.33       36.67
         74 |         46        3.33       40.00
         75 |         46        3.33       43.33
         76 |         46        3.33       46.67
         77 |         46        3.33       50.00
         78 |         46        3.33       53.33
         79 |         46        3.33       56.67
         80 |         46        3.33       60.00
         81 |         46        3.33       63.33
         82 |         46        3.33       66.67
         83 |         46        3.33       70.00
         84 |         46        3.33       73.33
         85 |         46        3.33       76.67
         86 |         46        3.33       80.00
         87 |         46        3.33       83.33
         88 |         46        3.33       86.67
         89 |         46        3.33       90.00
         90 |         46        3.33       93.33
         91 |         46        3.33       96.67
         92 |         46        3.33      100.00
------------+-----------------------------------
      Total |      1,380      100.00

. eststo Within: xtreg lnc lnclag lnp lny lnpn yrd*, fe
note: yrd1 omitted because of collinearity
note: yrd30 omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =      1,334
Group variable: state                           Number of groups  =         46

R-sq:                                           Obs per group:
     within  = 0.9964                                         min =         29
     between = 0.9859                                         avg =       29.0
     overall = 0.9947                                         max =         29

                                                F(32,1256)        =   10880.08
corr(u_i, Xb)  = 0.1667                         Prob > F          =     0.0000

------------------------------------------------------------------------------
         lnc |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   .8302515   .0126242    65.77   0.000     .8054847    .8550183
         lnp |  -.2916821   .0230847   -12.64   0.000    -.3369709   -.2463932
         lny |     .10687   .0233417     4.58   0.000     .0610769     .152663
        lnpn |   .0354562     .02656     1.33   0.182    -.0166507    .0875631
        yrd1 |          0  (omitted)
        yrd2 |   .2625931   .0271015     9.69   0.000     .2094239    .3157624
        yrd3 |   .2899732   .0258674    11.21   0.000     .2392251    .3407214
        yrd4 |   .2600526   .0253245    10.27   0.000     .2103695    .3097356
        yrd5 |   .2587544   .0246723    10.49   0.000     .2103509    .3071579
        yrd6 |   .2298556   .0239406     9.60   0.000     .1828877    .2768235
        yrd7 |   .2048639   .0233869     8.76   0.000     .1589823    .2507455
        yrd8 |   .1840194   .0224699     8.19   0.000     .1399368     .228102
        yrd9 |   .2307543   .0213872    10.79   0.000     .1887958    .2727128
       yrd10 |   .2425009   .0206783    11.73   0.000      .201933    .2830687
       yrd11 |   .1775635   .0201721     8.80   0.000     .1379888    .2171381
       yrd12 |   .1207647    .020777     5.81   0.000     .0800032    .1615262
       yrd13 |   .1065501   .0204389     5.21   0.000      .066452    .1466483
       yrd14 |   .1358017   .0193459     7.02   0.000     .0978479    .1737555
       yrd15 |   .0895934   .0193021     4.64   0.000     .0517255    .1274614
       yrd16 |   .0748198   .0179832     4.16   0.000     .0395393    .1101002
       yrd17 |  -.0034918   .0185773    -0.19   0.851    -.0399379    .0329542
       yrd18 |  -.0391436   .0198921    -1.97   0.049    -.0781689   -.0001183
       yrd19 |  -.0452863   .0206285    -2.20   0.028    -.0857564   -.0048163
       yrd20 |  -.0284583   .0193185    -1.47   0.141    -.0663584    .0094418
       yrd21 |  -.0074796   .0161571    -0.46   0.643    -.0391774    .0242183
       yrd22 |  -.0193512   .0136534    -1.42   0.157    -.0461371    .0074348
       yrd23 |    .009891     .01278     0.77   0.439    -.0151815    .0349636
       yrd24 |   .0181028   .0112771     1.61   0.109    -.0040213    .0402269
       yrd25 |  -.0074513   .0106683    -0.70   0.485     -.028381    .0134784
       yrd26 |  -.0243092   .0097891    -2.48   0.013     -.043514   -.0051044
       yrd27 |  -.0396239   .0089818    -4.41   0.000     -.057245   -.0220028
       yrd28 |  -.0549562   .0082085    -6.70   0.000    -.0710601   -.0388523
       yrd29 |  -.0354741   .0080744    -4.39   0.000    -.0513149   -.0196333
       yrd30 |          0  (omitted)
       _cons |   .9207886   .2834261     3.25   0.001     .3647478    1.476829
-------------+----------------------------------------------------------------
     sigma_u |    .027383
     sigma_e |  .03504775
         rho |  .37905099   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F test that all u_i=0: F(45, 1256) = 4.52                    Prob > F = 0.0000

. 
. *(3) 2SLS 
. eststo TSLS: xtivreg lnc lnp lny lnpn (lnclag = L.lnp L.lny L.lnpn)

G2SLS random-effects IV regression              Number of obs     =      1,334
Group variable: state                           Number of groups  =         46

R-sq:                                           Obs per group:
     within  = 0.9939                                         min =         29
     between = 0.9958                                         avg =       29.0
     overall = 0.9940                                         max =         29

                                                Wald chi2(4)      =   82367.03
corr(u_i, X)       = 0 (assumed)                Prob > chi2       =     0.0000

------------------------------------------------------------------------------
         lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   1.046833    .007192   145.55   0.000     1.032737    1.060929
         lnp |    .025158   .0159085     1.58   0.114    -.0060221    .0563381
         lny |  -.0219481   .0109251    -2.01   0.045    -.0433608   -.0005354
        lnpn |   .0942145   .0153108     6.15   0.000     .0642059    .1242231
       _cons |  -.6349696   .1642189    -3.87   0.000    -.9568327   -.3131065
-------------+----------------------------------------------------------------
     sigma_u |          0
     sigma_e |  .04782963
         rho |          0   (fraction of variance due to u_i)
------------------------------------------------------------------------------
Instrumented:   lnclag
Instruments:    lnp lny lnpn L.lnp L.lny L.lnpn
------------------------------------------------------------------------------

. 
. *(4) 2SLS-KR
. ssc install xtkr
checking xtkr consistency and verifying not already installed...
all files already exist and are up to date.

. eststo TSLSKR: xtkr lnc (lnclag lnp lny lnpn = d.l.lnc d.l(0/1).lnp d.l(0/1).lny d.l(0/1).lnpn yrd*)


Keane-Runkle (1992) Regression
Number of Obs: 1288                 Number of Panel Units: 46
------------------------------------------------------------------------------
         lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   1.014159   .0030723   330.10   0.000     1.008137     1.02018
         lnp |  -.2667994   .0289453    -9.22   0.000    -.3235313   -.2100676
         lny |  -.0951257   .0143151    -6.65   0.000    -.1231827   -.0670686
        lnpn |   .3873029    .028592    13.55   0.000     .3312637    .4433421
    constant |   .2264127   .1393512     1.62   0.104    -.0467105     .499536
------------------------------------------------------------------------------
Instruments: constant LD.lnc D.lnp LD.lnp D.lny LD.lny D.lnpn LD.lnpn yrd1 yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10 yrd11 yr
> d12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20 yrd21 yrd22 yrd23 yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 yrd30

. 
. *(5) Within-2SLS
. eststo Within2SLS: xtivreg lnc lnp lny lnpn yrd* (lnclag = L.lnp L.lny L.lnpn), fe
note: yrd1 omitted because of collinearity
note: yrd30 omitted because of collinearity

Fixed-effects (within) IV regression            Number of obs     =      1,334
Group variable: state                           Number of groups  =         46

R-sq:                                           Obs per group:
     within  = 0.9952                                         min =         29
     between = 0.9272                                         avg =       29.0
     overall = 0.9838                                         max =         29

                                                Wald chi2(32)     =   2.22e+07
corr(u_i, Xb)  = 0.1521                         Prob > chi2       =     0.0000

------------------------------------------------------------------------------
         lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   .5683385   .0357238    15.91   0.000     .4983212    .6383558
         lnp |  -.5170861   .0387588   -13.34   0.000     -.593052   -.4411203
         lny |   .2275951   .0309391     7.36   0.000     .1669555    .2882347
        lnpn |   -.014093    .031388    -0.45   0.653    -.0756124    .0474263
        yrd1 |          0  (omitted)
        yrd2 |    .690599   .0618285    11.17   0.000     .5694173    .8117807
        yrd3 |   .6973673   .0588929    11.84   0.000     .5819394    .8127952
        yrd4 |   .6689177   .0587337    11.39   0.000     .5538018    .7840337
        yrd5 |   .6546078   .0569537    11.49   0.000     .5429805    .7662351
        yrd6 |   .6233027   .0562722    11.08   0.000     .5130113    .7335941
        yrd7 |   .5765382   .0536043    10.76   0.000     .4714757    .6816006
        yrd8 |   .5451842   .0519394    10.50   0.000     .4433848    .6469835
        yrd9 |   .5707877   .0490358    11.64   0.000     .4746793     .666896
       yrd10 |    .573045   .0476019    12.04   0.000      .479747     .666343
       yrd11 |   .4865704   .0449988    10.81   0.000     .3983744    .5747664
       yrd12 |   .4010668   .0423818     9.46   0.000     .3179999    .4841336
       yrd13 |   .3617335   .0396135     9.13   0.000     .2840924    .4393745
       yrd14 |   .3743683   .0371995    10.06   0.000     .3014586    .4472779
       yrd15 |   .3059851   .0350045     8.74   0.000     .2373776    .3745926
       yrd16 |   .2789794   .0328577     8.49   0.000     .2145794    .3433794
       yrd17 |   .1655442    .030097     5.50   0.000     .1065552    .2245331
       yrd18 |   .0833616   .0276348     3.02   0.003     .0291984    .1375248
       yrd19 |   .0321685   .0257732     1.25   0.212    -.0183461    .0826831
       yrd20 |   .0365017   .0238001     1.53   0.125    -.0101456     .083149
       yrd21 |    .067369   .0209108     3.22   0.001     .0263846    .1083535
       yrd22 |   .0566023    .018429     3.07   0.002     .0204821    .0927225
       yrd23 |   .0671812   .0164355     4.09   0.000     .0349683    .0993941
       yrd24 |   .0728973   .0147393     4.95   0.000     .0440087    .1017858
       yrd25 |   .0423932   .0138307     3.07   0.002     .0152855    .0695008
       yrd26 |   .0151158   .0123586     1.22   0.221    -.0091065    .0393382
       yrd27 |  -.0112773   .0109892    -1.03   0.305    -.0328157    .0102612
       yrd28 |  -.0393913   .0097068    -4.06   0.000    -.0584163   -.0203663
       yrd29 |  -.0398492    .009372    -4.25   0.000     -.058218   -.0214803
       yrd30 |          0  (omitted)
       _cons |   2.227931   .3664924     6.08   0.000     1.509619    2.946243
-------------+----------------------------------------------------------------
     sigma_u |  .06670382
     sigma_e |  .04061161
         rho |  .72956492   (fraction of variance due to u_i)
------------------------------------------------------------------------------
F  test that all u_i=0:     F(45,1256) =     4.13         Prob > F    = 0.0000
------------------------------------------------------------------------------
Instrumented:   lnclag
Instruments:    lnp lny lnpn yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10
                yrd11 yrd12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20
                yrd21 yrd22 yrd23 yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 L.lnp
                L.lny L.lnpn
------------------------------------------------------------------------------

. 
. *(6) FD-2SLS
. eststo FD2SLS: xtivreg lnc lnp lny lnpn yrd* (lnclag = L.lnp L.lny L.lnpn), fd
note: yrd1 omitted because of collinearity
note: yrd30 omitted because of collinearity

First-differenced IV regression
Group variable:    state                        Number of obs     =      1,288
Time variable:     yr                           Number of groups  =         46

R-sq:                                           Obs per group:
     within  = 0.9404                                         min =         28
     between = 0.9961                                         avg =       28.0
     overall = 0.9277                                         max =         28

                                                Wald chi2(31)     =    1107.95
corr(u_i, Xb)  = 0.2714                         Prob > chi2       =     0.0000

------------------------------------------------------------------------------
       D.lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |
         D1. |   .2412362   .0613914     3.93   0.000     .1209114    .3615611
             |
         lnp |
         D1. |   -.391176   .0271552   -14.41   0.000    -.4443992   -.3379528
             |
         lny |
         D1. |   .1993205   .0439578     4.53   0.000     .1131648    .2854761
             |
        lnpn |
         D1. |  -.0043446   .0353347    -0.12   0.902    -.0735994    .0649102
             |
        yrd1 |
         D1. |          0  (omitted)
             |
        yrd2 |
         D1. |          0  (omitted)
             |
        yrd3 |
         D1. |   .0412594   .0058111     7.10   0.000     .0298699    .0526489
             |
        yrd4 |
         D1. |   .0565225   .0091998     6.14   0.000     .0384912    .0745539
             |
        yrd5 |
         D1. |   .0788699   .0114853     6.87   0.000     .0563591    .1013807
             |
        yrd6 |
         D1. |   .0827895   .0138008     6.00   0.000     .0557405    .1098385
             |
        yrd7 |
         D1. |   .0681694   .0149844     4.55   0.000     .0388006    .0975383
             |
        yrd8 |
         D1. |   .0588182   .0154942     3.80   0.000     .0284502    .0891862
             |
        yrd9 |
         D1. |   .1039655   .0155058     6.70   0.000     .0735748    .1343563
             |
       yrd10 |
         D1. |   .1467066   .0177145     8.28   0.000     .1119867    .1814264
             |
       yrd11 |
         D1. |   .1144546   .0214046     5.35   0.000     .0725022    .1564069
             |
       yrd12 |
         D1. |   .0691241   .0229871     3.01   0.003     .0240702    .1141781
             |
       yrd13 |
         D1. |   .0522676   .0228574     2.29   0.022     .0074678    .0970673
             |
       yrd14 |
         D1. |   .0841311   .0222328     3.78   0.000     .0405555    .1277066
             |
       yrd15 |
         D1. |   .0555589   .0242229     2.29   0.022      .008083    .1030348
             |
       yrd16 |
         D1. |   .0503038   .0238034     2.11   0.035       .00365    .0969575
             |
       yrd17 |
         D1. |  -.0323213   .0247998    -1.30   0.192    -.0809281    .0162855
             |
       yrd18 |
         D1. |  -.0999234   .0249268    -4.01   0.000    -.1487791   -.0510677
             |
       yrd19 |
         D1. |  -.1390732   .0252634    -5.50   0.000    -.1885885   -.0895579
             |
       yrd20 |
         D1. |   -.126337   .0234589    -5.39   0.000    -.1723156   -.0803584
             |
       yrd21 |
         D1. |  -.0892921   .0197244    -4.53   0.000    -.1279513    -.050633
             |
       yrd22 |
         D1. |   -.087356   .0170796    -5.11   0.000    -.1208315   -.0538806
             |
       yrd23 |
         D1. |  -.0618181   .0160449    -3.85   0.000    -.0932656   -.0303707
             |
       yrd24 |
         D1. |  -.0310349   .0146113    -2.12   0.034    -.0596726   -.0023972
             |
       yrd25 |
         D1. |  -.0313553   .0141457    -2.22   0.027    -.0590804   -.0036302
             |
       yrd26 |
         D1. |  -.0373324   .0129185    -2.89   0.004    -.0626523   -.0120125
             |
       yrd27 |
         D1. |  -.0473106   .0111394    -4.25   0.000    -.0691433   -.0254778
             |
       yrd28 |
         D1. |  -.0633038   .0087993    -7.19   0.000    -.0805502   -.0460575
             |
       yrd29 |
         D1. |  -.0519636   .0067759    -7.67   0.000    -.0652442    -.038683
             |
       yrd30 |
         D1. |          0  (omitted)
             |
       _cons |  -.0457512   .0040821   -11.21   0.000    -.0537519   -.0377506
-------------+----------------------------------------------------------------
     sigma_u |   .1251777
     sigma_e |  .03723114
         rho |  .91872716   (fraction of variance due to u_i)
------------------------------------------------------------------------------
Instrumented:   lnclag
Instruments:    lnp lny lnpn yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10
                yrd11 yrd12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20
                yrd21 yrd22 yrd23 yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 L.lnp
                L.lny L.lnpn
------------------------------------------------------------------------------

. 
. *(7) FD-2SLS-KR
. eststo FD2SLSKR: xtkr d.lnc (d.l.lnc d.lnp d.lny d.lnpn = l2.lnc l(1/2).lnp l(1/2).lny l(1/2).lnpn yrd*)


Keane-Runkle (1992) Regression
Number of Obs: 1288                 Number of Panel Units: 46
------------------------------------------------------------------------------
       D.lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnc |
         LD. |   .2521416   .0200582    12.57   0.000     .2128282     .291455
             |
         lnp |
         D1. |  -.2273068   .0421273    -5.40   0.000    -.3098748   -.1447387
             |
         lny |
         D1. |   .6984017   .0409508    17.05   0.000     .6181397    .7786637
             |
        lnpn |
         D1. |   .1857164   .0417142     4.45   0.000     .1039581    .2674747
             |
    constant |  -.0584026   .0017221   -33.91   0.000    -.0617779   -.0550273
------------------------------------------------------------------------------
Instruments: constant L2.lnc L.lnp L2.lnp L.lny L2.lny L.lnpn L2.lnpn yrd1 yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10 yrd11 yr
> d12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20 yrd21 yrd22 yrd23 yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 yrd30

. 
. *(8) GMM-1-Step
. ssc install xtabond2
checking xtabond2 consistency and verifying not already installed...
all files already exist and are up to date.

. eststo GMM1Step: xtabond2 lnc lnclag lnp lny lnpn yrd*, gmm(l.lnc) iv(lnp lny lnpn yrd*) noleveleq robust 
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
Warning: Number of instruments may be large relative to number of observations.
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate robust weighting matrix for Hansen test.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, one-step difference GMM
------------------------------------------------------------------------------
Group variable: state                           Number of obs      =      1288
Time variable : yr                              Number of groups   =        46
Number of instruments = 437                     Obs per group: min =        28
Wald chi2(34) = 325482.45                                      avg =     28.00
Prob > chi2   =     0.000                                      max =        28
------------------------------------------------------------------------------
             |               Robust
         lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   .8325298    .028453    29.26   0.000     .7767629    .8882966
         lnp |  -.3701281   .0426622    -8.68   0.000    -.4537444   -.2865118
         lny |   .1343292   .0611793     2.20   0.028       .01442    .2542385
        lnpn |  -.0277971   .0585045    -0.48   0.635    -.1424638    .0868697
        yrd1 |          0  (omitted)
        yrd2 |          0  (omitted)
        yrd3 |   .0245335    .008098     3.03   0.002     .0086618    .0404052
        yrd4 |  -.0036895   .0126763    -0.29   0.771    -.0285346    .0211556
        yrd5 |   -.006376   .0129135    -0.49   0.621    -.0316859     .018934
        yrd6 |   -.031973   .0116997    -2.73   0.006    -.0549039    -.009042
        yrd7 |  -.0610858   .0141126    -4.33   0.000     -.088746   -.0334255
        yrd8 |  -.0785204   .0185803    -4.23   0.000    -.1149371   -.0421038
        yrd9 |  -.0313602   .0193515    -1.62   0.105    -.0692885    .0065681
       yrd10 |  -.0207293   .0230216    -0.90   0.368    -.0658508    .0243922
       yrd11 |  -.0945154   .0256249    -3.69   0.000    -.1447392   -.0442916
       yrd12 |  -.1608971   .0265117    -6.07   0.000     -.212859   -.1089352
       yrd13 |  -.1774259   .0278202    -6.38   0.000    -.2319524   -.1228994
       yrd14 |  -.1454975   .0307275    -4.74   0.000    -.2057224   -.0852727
       yrd15 |  -.1973186   .0328163    -6.01   0.000    -.2616374   -.1329998
       yrd16 |  -.2082932   .0347039    -6.00   0.000    -.2763116   -.1402748
       yrd17 |  -.2948523   .0359774    -8.20   0.000    -.3653668   -.2243378
       yrd18 |   -.339155   .0389466    -8.71   0.000     -.415489    -.262821
       yrd19 |  -.3516521   .0434244    -8.10   0.000    -.4367625   -.2665418
       yrd20 |  -.3281651   .0442169    -7.42   0.000    -.4148286   -.2415016
       yrd21 |  -.2913099   .0452986    -6.43   0.000    -.3800935   -.2025264
       yrd22 |  -.2917243   .0476427    -6.12   0.000    -.3851023   -.1983462
       yrd23 |  -.2596075   .0490943    -5.29   0.000    -.3558306   -.1633845
       yrd24 |  -.2446946   .0526655    -4.65   0.000    -.3479171   -.1414721
       yrd25 |   -.267319   .0549298    -4.87   0.000    -.3749794   -.1596587
       yrd26 |  -.2802805   .0561697    -4.99   0.000    -.3903711   -.1701899
       yrd27 |  -.2906365   .0603246    -4.82   0.000    -.4088707   -.1724024
       yrd28 |  -.3003276   .0621047    -4.84   0.000    -.4220506   -.1786046
       yrd29 |  -.2785422    .065695    -4.24   0.000     -.407302   -.1497823
       yrd30 |   -.230017    .070966    -3.24   0.001    -.3691079   -.0909261
------------------------------------------------------------------------------
Instruments for first differences equation
  Standard
    D.(lnp lny lnpn yrd1 yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10 yrd11
    yrd12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20 yrd21 yrd22 yrd23
    yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 yrd30)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(1/29).L.lnc
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z =  -5.08  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   2.14  Pr > z =  0.032
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(403)  = 561.83  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(403)  =  24.41  Prob > chi2 =  1.000
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  iv(lnp lny lnpn yrd1 yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10 yrd11 yrd12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20 
> yrd21 yrd22 yrd23 yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 yrd30)
    Hansen test excluding group:     chi2(372)  =  20.16  Prob > chi2 =  1.000
    Difference (null H = exogenous): chi2(31)   =   4.26  Prob > chi2 =  1.000


. 
. *(9) GMM-2-Step
. eststo GMM2Step: xtabond2 lnc lnclag lnp lny lnpn yrd*, gmm(l.lnc) iv(lnp lny lnpn yrd*) noleveleq twostep 
Favoring space over speed. To switch, type or click on mata: mata set matafavor speed, perm.
Warning: Number of instruments may be large relative to number of observations.
Warning: Two-step estimated covariance matrix of moments is singular.
  Using a generalized inverse to calculate optimal weighting matrix for two-step estimation.
  Difference-in-Sargan/Hansen statistics may be negative.

Dynamic panel-data estimation, two-step difference GMM
------------------------------------------------------------------------------
Group variable: state                           Number of obs      =      1288
Time variable : yr                              Number of groups   =        46
Number of instruments = 437                     Obs per group: min =        28
Wald chi2(34) =  1.21e+06                                      avg =     28.00
Prob > chi2   =     0.000                                      max =        28
------------------------------------------------------------------------------
         lnc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      lnclag |   .7237568   .1470698     4.92   0.000     .4355054    1.012008
         lnp |  -.4054118   .0437029    -9.28   0.000    -.4910679   -.3197556
         lny |   .2708228   .2599324     1.04   0.297    -.2386354     .780281
        lnpn |  -.0492178   .0500383    -0.98   0.325    -.1472911    .0488554
        yrd1 |          0  (omitted)
        yrd2 |   .0186796   .0257144     0.73   0.468    -.0317197    .0690789
        yrd3 |   .0321059   .0079483     4.04   0.000     .0165276    .0476843
        yrd4 |          0  (omitted)
        yrd5 |  -.0089751   .0164104    -0.55   0.584    -.0411388    .0231886
        yrd6 |  -.0383152   .0252658    -1.52   0.129    -.0878352    .0112048
        yrd7 |  -.0797499    .036271    -2.20   0.028    -.1508398   -.0086599
        yrd8 |  -.1096543    .049058    -2.24   0.025    -.2058062   -.0135025
        yrd9 |  -.0682425   .0647975    -1.05   0.292    -.1952433    .0587584
       yrd10 |  -.0684663   .0784085    -0.87   0.383     -.222144    .0852115
       yrd11 |  -.1541851   .0953809    -1.62   0.106    -.3411283     .032758
       yrd12 |   -.220582   .0944054    -2.34   0.019    -.4056132   -.0355509
       yrd13 |  -.2500441   .1033771    -2.42   0.016    -.4526595   -.0474287
       yrd14 |  -.2277936    .117303    -1.94   0.052    -.4577033    .0021161
       yrd15 |  -.2844126   .1298347    -2.19   0.028     -.538884   -.0299412
       yrd16 |  -.3091539   .1459283    -2.12   0.034    -.5951682   -.0231396
       yrd17 |  -.4050552   .1549426    -2.61   0.009    -.7087372   -.1013733
       yrd18 |  -.4633495   .1620578    -2.86   0.004     -.780977   -.1457221
       yrd19 |   -.487801   .1790091    -2.73   0.006    -.8386524   -.1369497
       yrd20 |  -.4761419    .193179    -2.46   0.014    -.8547658   -.0975179
       yrd21 |  -.4396522    .208869    -2.10   0.035    -.8490279   -.0302764
       yrd22 |  -.4467161   .2270513    -1.97   0.049    -.8917285   -.0017037
       yrd23 |  -.4266644   .2435701    -1.75   0.080    -.9040531    .0507244
       yrd24 |  -.4194304   .2584193    -1.62   0.105    -.9259229    .0870621
       yrd25 |  -.4461261   .2658054    -1.68   0.093    -.9670952     .074843
       yrd26 |   -.469357    .283279    -1.66   0.098    -1.024574    .0858597
       yrd27 |  -.4874118   .2961218    -1.65   0.100      -1.0678    .0929763
       yrd28 |  -.5038321   .3123716    -1.61   0.107    -1.116069    .1084051
       yrd29 |  -.4939214    .322699    -1.53   0.126      -1.1264     .138557
       yrd30 |  -.4525123   .3436775    -1.32   0.188    -1.126108    .2210833
------------------------------------------------------------------------------
Warning: Uncorrected two-step standard errors are unreliable.

Instruments for first differences equation
  Standard
    D.(lnp lny lnpn yrd1 yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10 yrd11
    yrd12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20 yrd21 yrd22 yrd23
    yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 yrd30)
  GMM-type (missing=0, separate instruments for each period unless collapsed)
    L(1/29).L.lnc
------------------------------------------------------------------------------
Arellano-Bond test for AR(1) in first differences: z =  -4.44  Pr > z =  0.000
Arellano-Bond test for AR(2) in first differences: z =   1.82  Pr > z =  0.068
------------------------------------------------------------------------------
Sargan test of overid. restrictions: chi2(403)  = 561.83  Prob > chi2 =  0.000
  (Not robust, but not weakened by many instruments.)
Hansen test of overid. restrictions: chi2(403)  =  24.41  Prob > chi2 =  1.000
  (Robust, but weakened by many instruments.)

Difference-in-Hansen tests of exogeneity of instrument subsets:
  iv(lnp lny lnpn yrd1 yrd2 yrd3 yrd4 yrd5 yrd6 yrd7 yrd8 yrd9 yrd10 yrd11 yrd12 yrd13 yrd14 yrd15 yrd16 yrd17 yrd18 yrd19 yrd20 
> yrd21 yrd22 yrd23 yrd24 yrd25 yrd26 yrd27 yrd28 yrd29 yrd30)
    Hansen test excluding group:     chi2(372)  =  20.16  Prob > chi2 =  1.000
    Difference (null H = exogenous): chi2(31)   =   4.26  Prob > chi2 =  1.000


. 
. esttab OLS Within TSLS TSLSKR Within2SLS FD2SLS FD2SLSKR GMM1Step GMM2Step ///
>         using $root\Table2.rtf, replace se noobs compress nogaps label ///
>         mtitle("OLS" "Within" "TSLS" "TSLSKR" "Within2SLS" "FD2SLS" "FD2SLSKR" "GMM1Step" "GMM2Step") ///
>         title(Table 2: Replication of Table 8.1) ///
>         keep(lnclag lnp lny lnpn) order(lnclag lnp lny lnpn) nonotes ///
> 
file C:\Users\cl3852\Documents\GitHub\PanelEconometrics\Assignments\HW5\Table2.rtf is read-only; cannot be modified or erased
r(608);

end of do-file

r(608);

. help lag

